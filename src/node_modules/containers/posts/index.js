import React, {Component} from 'react'
import {connect} from 'react-redux'
import * as R from 'ramda'
import {Link} from 'react-router-dom'

import {fetchPosts} from 'actions'
import {getPosts} from 'selectors'
import Layout from 'containers/layout'

class Posts extends Component {
  componentDidMount() {
    this.props.fetchPosts()
  }

  renderPost(post, index) {
    const isEmpty = post.image.length
    const srcImg = isEmpty > 0 ? post.image : 'https://ukrinsoft.com/wp-content/uploads/1-5.jpg'
    const datePost = `${R.take(10, post.createdAt)}`
    return (
      <div className="item"
           key={index}>
        <div className="card">
          <img
            className="card-img-top img-respons"
            src={srcImg}
            alt="post-img"/>
          <div className="card-body">
            <h4 className="card-title">Опис статті: <span className="pull-right">{datePost}</span></h4>
            <p className="card-text">{post.text}</p>
            <Link to={`/posts/${post.id}`}
              className='btn btn-default'>Read more</Link>
          </div>
        </div>
      </div>
    )
  }

  render() {
    const {posts} = this.props
    return (
      <Layout>
      <div className='wrapper'>
        {posts.map((post, index) => this.renderPost(post, index))}
      </div>
      </Layout>
    )
  }
}

const mapStateToProps = state => ({
  posts: getPosts(state)
})
const mapDispatchToProps = {
  fetchPosts
}
export default connect(mapStateToProps, mapDispatchToProps)(Posts)